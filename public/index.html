<script>
    async function loadGameData() {
        try {
            const response = await fetch('/api/fetchGames'); // Fetch from Vercel API
            const games = await response.json();
            
            initializeCategories(games);
            displayGames(games);
        } catch (error) {
            console.error('Error loading game data:', error);
        }
    }

    function initializeCategories(games) {
        const categories = [...new Set(games.map(game => game.category))];
        const categoryGrid = document.getElementById('category-grid');
        categoryGrid.innerHTML = ""; // Clear previous content

        categories.forEach(category => {
            let div = document.createElement('div');
            div.classList.add('category-button');
            div.textContent = category;
            div.addEventListener('click', () => displayGames(games, category));
            categoryGrid.appendChild(div);
        });
    }

    function displayGames(games, category = '') {
        const gamesContainer = document.getElementById('games-container');
        gamesContainer.innerHTML = '';
        const filteredGames = category ? games.filter(game => game.category === category) : games;

        filteredGames.forEach(game => {
            const gameCard = document.createElement('div');
            gameCard.classList.add('game-card');
            gameCard.innerHTML = `
                <img src="${game.thumbnail}" alt="${game.title}">
                <p>${game.title}</p>
            `;
            gameCard.addEventListener('click', () => window.open(game.url, '_blank'));
            gamesContainer.appendChild(gameCard);
        });

        document.getElementById('category-title').textContent = category ? category : 'ðŸ”¥ Popular Games ðŸ”¥';
    }

    window.onload = loadGameData;
</script>
